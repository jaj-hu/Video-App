<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Video App</title>
<style>
  :root{
    --bg:#000;
    --panel:#0f1113;
    --muted:#9aa0a6;
    --accent:#ff3b2f;
    --white:#fff;
    --card-shadow: 0 12px 40px rgba(0,0,0,0.6);
  }
  html,body{height:100%; margin:0; font-family:Inter,Arial,sans-serif; background:var(--bg); color:var(--white);}
  .wrap{max-width:980px; margin:0 auto; padding:12px;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
  .logo{font-weight:800; font-size:20px;}
  .subtitle{color:var(--muted); font-size:13px;}

  /* hero top */
  .hero {
    display:block;
    width:100%;
    border-radius:12px;
    overflow:hidden;
    background:#090909;
    margin-bottom:18px;
    box-shadow:var(--card-shadow);
    border:1px solid rgba(255,255,255,0.03);
    transform: translateY(12px);
    opacity:0;
    transition: transform .45s cubic-bezier(.2,.8,.2,1), opacity .45s ease;
  }
  .hero.show { transform:translateY(0); opacity:1; }
  .hero img{ display:block; width:100%; height:auto; object-fit:contain; }

  .hero-title{ padding:10px 6px; color:var(--white); font-weight:700; font-size:18px; text-align:left; }

  /* groups */
  .groups { display:flex; flex-direction:column; gap:18px; margin-bottom:30px; }
  .group {
    border-radius:12px; overflow:hidden; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    box-shadow:var(--card-shadow); border:1px solid rgba(255,255,255,0.03);
    transform: translateY(12px); opacity:0; transition: transform .45s cubic-bezier(.2,.8,.2,1), opacity .45s ease;
  }
  .group.show { transform:translateY(0); opacity:1; }
  .group-hero { width:100%; display:block; overflow:hidden; }
  .group-hero img{ width:100%; height:auto; display:block; object-fit:contain; }
  .group-title { padding:10px 12px; font-weight:700; font-size:16px; color:var(--white); }

  /* modal (fullscreen) */
  .modal-backdrop{ position:fixed; inset:0; display:none; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center; }
  .modal-backdrop.open{ display:flex; }
  .modal{ width:100%; max-width:980px; height:100%; background:var(--panel); border-radius:0; overflow:auto; display:flex; flex-direction:column; }
  .modal-top { position:relative; }
  .modal-top img{ width:100%; height:auto; display:block; object-fit:contain; }
  .modal-title { padding:12px; font-weight:800; font-size:20px; color:var(--white); }
  .modal-body{ padding:12px; overflow:auto; flex:1; }

  /* episode list in modal (thumbnail row) */
  .ep-row{ display:flex; gap:12px; align-items:center; padding:10px 6px; border-radius:8px; transition: background .12s ease; }
  .ep-row:hover{ background: rgba(255,255,255,0.02); }
  .ep-thumb{ width:120px; height:72px; border-radius:8px; overflow:hidden; background:#000; display:flex; align-items:center; justify-content:center; flex:0 0 120px; }
  .ep-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .ep-info{ flex:1; min-width:0; }
  .ep-title{ font-weight:700; font-size:15px; }
  .ep-sub{ color:var(--muted); font-size:13px; margin-top:6px; }
  .ep-actions{ display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
  .watch-btn{ background:var(--accent); color:var(--white); padding:10px 14px; border-radius:8px; text-decoration:none; font-weight:800; font-size:14px; }
  .download-small{ color:var(--muted); font-size:13px; text-decoration:underline; background:none; border:none; cursor:pointer; }

  /* small loading */
  .loading{ text-align:center; color:var(--muted); padding:18px; font-size:15px; }

  @media (max-width:720px){
    .ep-thumb{ width:96px; height:56px; }
    .watch-btn{ padding:9px 12px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="logo">My Videos</div>
        <div class="subtitle">Preparing your anime...</div>
      </div>
    </header>

    <main id="appContent">
      <div id="loading" class="loading">Preparing your anime...</div>
      <!-- hero + groups injected here -->
      <div id="heroContainer"></div>
      <div class="groups" id="groupsContainer"></div>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-top" id="modalTop"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

<script>
(async function(){
  const loadingEl = document.getElementById('loading');
  const heroContainer = document.getElementById('heroContainer');
  const groupsContainer = document.getElementById('groupsContainer');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const modalTop = document.getElementById('modalTop');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');

  // fetch videos.txt
  async function fetchTxt(){
    const r = await fetch('videos.txt?_=' + Date.now());
    if(!r.ok) throw new Error('Could not load videos.txt');
    const txt = await r.text();
    return txt.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);
  }

  // parse into groups
  function parseGroups(lines){
    const groups = [];
    let current = null;
    for(const line of lines){
      if(line.startsWith('#GROUP:') || line.startsWith('#group') ){
        // format: #GROUP: Name | BannerURL
        const rest = line.split(':')[1] || '';
        const parts = rest.split('|').map(p=>p.trim());
        const name = parts[0] || 'Untitled';
        const banner = parts[1] || '';
        current = { name, banner, items: [] };
        groups.push(current);
      } else {
        // episode line: thumb | link | title
        const parts = line.split('|').map(p=>p.trim());
        if(parts.length >= 3){
          const ep = { thumb: parts[0]||'', link: parts[1]||'', title: parts[2]||'Untitled' };
          if(!current){
            // if no group declared yet, create default
            current = { name: 'Misc', banner: '', items: [] };
            groups.push(current);
          }
          current.items.push(ep);
        }
      }
    }
    return groups;
  }

  // render page
  try {
    const lines = await fetchTxt();
    const groups = parseGroups(lines);
    if(groups.length === 0){
      loadingEl.textContent = 'No items found in videos.txt';
      return;
    }

    // hero = first group
    const heroGroup = groups[0];
    // create hero element (full poster image as-is)
    const heroEl = document.createElement('section');
    heroEl.className = 'hero';
    heroEl.innerHTML = `
      <img src="${heroGroup.banner || (heroGroup.items[0] && heroGroup.items[0].thumb) || ''}" alt="${heroGroup.name}">
      <div class="hero-title">${heroGroup.name}</div>
    `;
    heroContainer.appendChild(heroEl);
    // show animation
    requestAnimationFrame(()=> heroEl.classList.add('show'));

    // build groups list (each group gets its own banner + title)
    groups.forEach((g, idx) => {
      const groupEl = document.createElement('section');
      groupEl.className = 'group';
      groupEl.innerHTML = `
        <div class="group-hero">
          <img src="${g.banner || (g.items[0] && g.items[0].thumb) || ''}" alt="${g.name}">
        </div>
        <div class="group-title">${g.name} <span style="color:var(--muted); font-weight:400; font-size:13px; margin-left:8px;">${g.items.length} episode${g.items.length>1?'s':''}</span></div>
      `;
      // click opens modal full-screen (fullscreen modal with banner + episode list)
      groupEl.addEventListener('click', ()=> openGroupModal(g));
      groupsContainer.appendChild(groupEl);
      // animate show
      setTimeout(()=> groupEl.classList.add('show'), 120 * idx);
    });

    // hide loading
    loadingEl.style.display = 'none';
  } catch(err){
    loadingEl.textContent = 'Error loading videos: ' + (err.message || err);
    console.error(err);
    return;
  }

  // open modal (fullscreen) for a group
  function openGroupModal(group){
    // sort newest on top (we assume file order; latest added should be on top if your videos.txt uses newest-first)
    const items = group.items.slice().reverse(); // reverse so newest appears first
    // top banner uses group's banner or first item thumb
    const topImg = group.banner || (group.items[0] && group.items[0].thumb) || '';
    modalTop.innerHTML = `<img src="${topImg}" alt="${group.name}">`;
    modalTitle.textContent = group.name;
    // build episode rows
    modalBody.innerHTML = '';
    for(const ep of items){
      const row = document.createElement('div');
      row.className = 'ep-row';
      row.innerHTML = `
        <div class="ep-thumb"><img src="${ep.thumb}" alt="${ep.title}" onerror="this.style.display='none'; this.parentElement.style.background='#0b0b0b'"></div>
        <div class="ep-info">
          <div class="ep-title">${ep.title}</div>
          <div class="ep-sub">${ep.link.includes('mega.nz') ? 'MEGA (download)' : 'YouTube'}</div>
        </div>
        <div class="ep-actions">
          <a class="watch-btn" href="player.html?url=${encodeURIComponent(ep.link)}&title=${encodeURIComponent(ep.title)}">â–¶ Watch</a>
          <a class="download-small" href="${ep.link}" target="_blank" rel="noopener">Download</a>
        </div>
      `;
      modalBody.appendChild(row);
      // separator
      const sep = document.createElement('div'); sep.style.height='1px'; sep.style.background='rgba(255,255,255,0.02)'; sep.style.margin='8px 0';
      modalBody.appendChild(sep);
    }

    // show modal
    modalBackdrop.classList.add('open');
    modalBackdrop.setAttribute('aria-hidden','false');
    // lock scroll
    document.body.style.overflow = 'hidden';
  }

  // close modal helpers: click outside, Escape
  modalBackdrop.addEventListener('click', function(e){
    if(e.target === modalBackdrop){
      modalBackdrop.classList.remove('open');
      modalBackdrop.setAttribute('aria-hidden','true');
      modalBody.innerHTML = '';
      document.body.style.overflow = '';
    }
  });
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){
      modalBackdrop.classList.remove('open');
      modalBackdrop.setAttribute('aria-hidden','true');
      modalBody.innerHTML = '';
      document.body.style.overflow = '';
    }
  });

})();
</script>
</body>
</html>
