<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Video App</title>
<style>
  :root{
    --bg:#000;
    --card:#0f1113;
    --muted:#9aa0a6;
    --accent:#ff3b2f;
    --white:#fff;
    --shadow: 0 12px 40px rgba(0,0,0,0.6);
  }
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Arial,sans-serif; background:var(--bg); color:var(--white);}
  .wrap{max-width:1080px; margin:0 auto; padding:14px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .logo{font-weight:800;font-size:20px}
  .subtitle{color:var(--muted);font-size:13px}

  /* Poster grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
  .card{background:transparent;border-radius:12px;overflow:hidden;cursor:pointer;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow);transition:transform .18s ease}
  .card:hover{transform:translateY(-6px)}
  .card img{display:block;width:100%;height:280px;object-fit:cover}
  .card .title{padding:10px 12px;font-weight:700;font-size:15px;color:var(--white);line-height:1.1}
  .card .meta{padding:0 12px 12px 12px;color:var(--muted);font-size:13px}

  /* modal fullscreen */
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:9999}
  .backdrop.open{display:flex}
  .modal{width:100%;max-width:900px;height:100%;background:var(--card);overflow:auto;border-radius:0;display:flex;flex-direction:column}
  .modal-top img{width:100%;height:auto;display:block;object-fit:contain}
  .modal-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03)}
  .modal-title{font-weight:800;font-size:18px}
  .close-btn{background:transparent;border:none;color:var(--white);font-size:20px;cursor:pointer;padding:8px}
  .modal-body{padding:12px;flex:1;overflow:auto}
  .episode{display:flex;align-items:center;justify-content:space-between;padding:10px 6px;border-radius:8px;transition:background .12s}
  .episode:hover{background:rgba(255,255,255,0.02)}
  .ep-left{display:flex;align-items:center;gap:12px}
  .ep-thumb{width:92px;height:52px;border-radius:8px;overflow:hidden;background:#000;flex:0 0 92px}
  .ep-thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .ep-info{min-width:0}
  .ep-title{font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .ep-sub{color:var(--muted);font-size:13px;margin-top:6px}
  .ep-actions{display:flex;gap:10px;align-items:center}
  .watch-btn{background:var(--accent);color:var(--white);padding:9px 12px;border-radius:8px;text-decoration:none;font-weight:800}
  .download-link{color:var(--muted);font-size:13px;text-decoration:underline;background:none;border:none;cursor:pointer}

  .loading{padding:40px 0;text-align:center;color:var(--muted)}

  @media (max-width:720px){
    .card img{height:220px}
    .ep-thumb{width:84px;height:48px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="logo">My Videos</div>
        <div class="subtitle">Tap a poster to open episodes</div>
      </div>
    </header>

    <main>
      <div id="loading" class="loading">Preparing your anime...</div>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>
  </div>

  <!-- Modal -->
  <div id="backdrop" class="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-top" id="modalTop"></div>
      <div class="modal-head">
        <div class="modal-title" id="modalTitle">Title</div>
        <button id="closeModal" class="close-btn" aria-label="Close">✕</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

<script>
/*
  videos.txt format (new):
  #GROUP: Anime Title | BANNER_OR_POSTER_URL
  THUMB_URL | VIDEO_LINK | Episode Title
  THUMB_URL | VIDEO_LINK | Episode Title
  (empty line optional between groups)
*/
(async function(){
  const grid = document.getElementById('grid');
  const loading = document.getElementById('loading');
  const backdrop = document.getElementById('backdrop');
  const modalTop = document.getElementById('modalTop');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  const closeModal = document.getElementById('closeModal');

  // fetch videos.txt
  async function loadLines(){
    const r = await fetch('videos.txt?_=' + Date.now());
    if(!r.ok) throw new Error('videos.txt load failed');
    const txt = await r.text();
    return txt.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);
  }

  function parse(lines){
    const groups = [];
    let cur = null;
    for(const line of lines){
      if(line.startsWith('#GROUP:') || line.startsWith('#group:') || line.startsWith('#group')){
        const body = line.split(':').slice(1).join(':').trim();
        const parts = body.split('|').map(p=>p.trim());
        const name = parts[0] || 'Untitled';
        const banner = parts[1] || '';
        cur = { name, banner, items: [] };
        groups.push(cur);
      } else {
        const parts = line.split('|').map(p=>p.trim());
        if(parts.length >= 3){
          const ep = { thumb: parts[0]||'', link: parts[1]||'', title: parts[2]||'Untitled' };
          if(!cur){
            // create a default group if not declared
            cur = { name: 'All Videos', banner:'', items: [] };
            groups.push(cur);
          }
          cur.items.push(ep);
        }
      }
    }
    return groups;
  }

  function makeCard(group){
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <img src="${group.banner || (group.items[0] && group.items[0].thumb) || ''}" alt="${group.name}">
      <div class="title">${group.name}</div>
      <div class="meta">${group.items.length} episode${group.items.length>1?'s':''}</div>
    `;
    el.addEventListener('click', ()=> openGroup(group));
    return el;
  }

  function openGroup(group){
    // show modal: modalTop banner + list (simple text list)
    modalTop.innerHTML = `<img src="${group.banner || (group.items[0] && group.items[0].thumb) || ''}" alt="${group.name}">`;
    modalTitle.textContent = group.name;
    // episodes: newest first (reverse so newest on top)
    const items = group.items.slice().reverse();
    modalBody.innerHTML = '';
    items.forEach(ep => {
      const row = document.createElement('div');
      row.className = 'episode';
      row.innerHTML = `
        <div class="ep-left">
          <div class="ep-thumb"><img src="${ep.thumb}" alt="${ep.title}" onerror="this.style.display='none'; this.parentElement.style.background='#0b0b0b'"></div>
          <div class="ep-info">
            <div class="ep-title">${ep.title}</div>
            <div class="ep-sub">${ep.link.includes('mega.nz') ? 'MEGA (download)' : 'YouTube'}</div>
          </div>
        </div>
        <div class="ep-actions">
          <a class="watch-btn" href="player.html?url=${encodeURIComponent(ep.link)}&title=${encodeURIComponent(ep.title)}">▶ Watch</a>
          <a class="download-link" href="${ep.link}" target="_blank" rel="noopener">Download</a>
        </div>
      `;
      modalBody.appendChild(row);
    });

    backdrop.classList.add('open');
    backdrop.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  }

  // close handlers
  closeModal.addEventListener('click', closeAll);
  backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeAll(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeAll(); });
  function closeAll(){
    backdrop.classList.remove('open');
    backdrop.setAttribute('aria-hidden','true');
    modalBody.innerHTML = '';
    document.body.style.overflow = '';
  }

  // load and render
  try {
    const lines = await loadLines();
    const groups = parse(lines);
    if(groups.length === 0){
      loading.textContent = 'No videos found. Add lines to videos.txt';
      return;
    }
    loading.style.display = 'none';
    // show grid: one card per group (your two anime)
    groups.forEach(g => {
      const card = makeCard(g);
      grid.appendChild(card);
    });
  } catch(err){
    loading.textContent = 'Error: ' + (err.message || err);
    console.error(err);
  }

})();
</script>
</body>
</html>
