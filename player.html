<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Player</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
<style>
  body{margin:0;background:#000;color:#fff;font-family:Inter,Arial,system-ui}
  .wrap{height:100vh;display:flex;flex-direction:column}
  .top{padding:10px;display:flex;align-items:center;gap:12px}
  .title{font-weight:700}
  .player-wrap{flex:1;display:flex;align-items:center;justify-content:center;padding:12px}
  .note{color:#aaa;font-size:13px;padding:8px;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a href="index.html" style="color:#fff;text-decoration:none">← Home</a>
      <div class="title" id="videoTitle">Loading…</div>
    </div>
    <div class="player-wrap" id="playerWrap">
      <div id="player"></div>
    </div>
    <div id="note" class="note"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>
<script>
(function(){
  const params = new URLSearchParams(window.location.search);
  const raw = params.get('url') || '';
  const title = params.get('title') ? decodeURIComponent(params.get('title')) : '';
  const videoTitle = document.getElementById('videoTitle');
  const note = document.getElementById('note');

  function extractYouTubeID(url){
    if(!url) return '';
    url = url.trim();
    const short = url.match(/youtu\.be\/([A-Za-z0-9_-]{4,})/);
    if(short && short[1]) return short[1];
    try {
      const u = new URL(url);
      if(u.searchParams && u.searchParams.get('v')) return u.searchParams.get('v');
      const emb = url.match(/\/embed\/([A-Za-z0-9_-]{4,})/);
      if(emb && emb[1]) return emb[1];
    } catch(e){}
    return '';
  }

  videoTitle.textContent = title || 'Video';

  const id = extractYouTubeID(raw);
  if(id){
    // YouTube via Plyr
    const playerDiv = document.getElementById('player');
    playerDiv.innerHTML = `<div data-plyr-provider="youtube" data-plyr-embed-id="${id}"></div>`;
    const plyr = new Plyr('#player', {controls:['play','progress','current-time','mute','volume','fullscreen'], autoplay:false, hideControls:true, seekTime:10});
    note.textContent = '';
  } else if(raw && raw.includes('mega.nz')){
    // open MEGA page (downloads / MEGA viewer)
    note.innerHTML = 'This is a MEGA link — it will open the MEGA page where users can download or play. If you want in-app playback, host a direct MP4 or use YouTube unlisted.';
    // open MEGA in same tab so user stays in-app webview (you can change to _blank)
    setTimeout(()=> { window.location.href = raw; }, 1200);
  } else if(raw){
    // Try direct video file
    const playerDiv = document.getElementById('player');
    playerDiv.innerHTML = `<video id="v" controls playsinline style="width:100%;max-width:1000px"><source src="${raw}"></video>`;
    const plyr = new Plyr('#v', {controls:['play','progress','current-time','mute','volume','fullscreen'], autoplay:false, hideControls:true, seekTime:10});
    note.textContent = '';
  } else {
    note.textContent = 'Invalid or missing video link.';
  }
})();
</script>
</body>
</html>
